- name: Check if Availability Zone exisits
  uri:
    url: https://{{ONAP_k8s_IP}}:30233/aai/v16/cloud-infrastructure/cloud-regions/cloud-region/{{region_details.cloud_owner}}/{{region_details.region_id}}/availability-zones/availability-zone/{{region_details.availability_zone}}
    url_username: "{{ AAI_user }}"
    url_password: "{{ AAI_pass }}"
    force_basic_auth: yes
    headers:
      Accept: "application/json"
      Content-Type: "application/json"
      X-FromAppId: "Ansible"
      X-TransactionId: "get_aai_subscr"
    method: GET
    status_code: 200, 404
    return_content: yes
    validate_certs: False
  register: checkAvailabilityZone

- name: Create Availability Zone
  uri:
    url: https://{{ONAP_k8s_IP}}:30233/aai/v16/cloud-infrastructure/cloud-regions/cloud-region/{{region_details.cloud_owner}}/{{region_details.region_id}}/availability-zones/availability-zone/{{region_details.availability_zone}}
    url_username: "{{ AAI_user }}"
    url_password: "{{ AAI_pass }}"
    force_basic_auth: yes
    headers:
      Accept: "application/json"
      Content-Type: "application/json"
      X-FromAppId: "Ansible"
      X-TransactionId: "get_aai_subscr"
    method: PUT
    status_code: 201
    return_content: yes
    validate_certs: False
    body_format: json
    body: >
      {"availability-zone-name": "{{region_details.availability_zone}}","hypervisor-type": "{{region_details.type}}"}
  when: checkAvailabilityZone.status == 404
