- name: Check if Complex exisits
  uri:
    url: https://{{ONAP_k8s_IP}}:30233/aai/v16/cloud-infrastructure/complexes/complex/{{complex_id}}
    url_username: "{{ AAI_user }}"
    url_password: "{{ AAI_pass }}"
    force_basic_auth: yes
    headers:
      Accept: "application/json"
      Content-Type: "application/json"
      X-FromAppId: "Ansible"
      X-TransactionId: "get_aai_subscr"
    method: GET
    status_code: 200, 404
    return_content: yes
    validate_certs: False
  register: checkComplex

- name: Prepare create-complex.json
  copy:
    dest: tmp/create-complex.json
    content: |
      {
          "physical-location-id": "{{complex_id}}",
          "physical-location-type": "office",
          "street1": "DummyStreet 1",
          "city": "DummyCity",
          "postal-code": "00-000",
          "country": "DummyCountry",
          "region": "DummyRegion"
      }
  when: checkComplex.status == 404

- name: Create Complex
  uri:
    url: https://{{ONAP_k8s_IP}}:30233/aai/v16/cloud-infrastructure/complexes/complex/{{complex_id}}
    url_username: "{{ AAI_user }}"
    url_password: "{{ AAI_pass }}"
    force_basic_auth: yes
    headers:
      Accept: "application/json"
      Content-Type: "application/json"
      X-FromAppId: "Ansible"
      X-TransactionId: "get_aai_subscr"
    method: PUT
    status_code: 201
    return_content: yes
    validate_certs: False
    body_format: json
    body: "{{ lookup('file','tmp/create-complex.json') }}"
  when: checkComplex.status == 404
